@model IEnumerable<PhotoBooking.Models.YeuCau>

@{
    ViewData["Title"] = "Cơ hội việc làm";
}

<div class="bg-primary py-5 mb-5 position-relative overflow-hidden">
    <div class="position-absolute top-0 start-0 w-100 h-100 opacity-10"
         style="background: url('https://www.transparenttextures.com/patterns/camera-aperture.png');"></div>

    <div class="container position-relative z-1 text-center text-white">
        <h1 class="fw-bold display-5 mb-3">Tìm kiếm dự án chụp ảnh</h1>
        <p class="lead mb-4">Kết nối ngay với khách hàng đang tìm kiếm tài năng của bạn</p>

        <div class="card border-0 shadow-lg p-2 rounded-pill mx-auto" style="max-width: 700px;">
            <form asp-action="JobMarket" method="get" class="d-flex">
                <input type="text" name="searchLocation" class="form-control border-0 rounded-pill ps-4 fs-5"
                       placeholder="Nhập địa điểm (VD: Hà Nội, Đà Lạt...)"
                       value="@ViewBag.CurrentFilter" autocomplete="off">
                <button type="submit" class="btn btn-dark rounded-pill px-4 fw-bold ms-2">
                    <i class="fa-solid fa-magnifying-glass me-2"></i> Tìm
                </button>
            </form>
        </div>

        <div class="mt-3 small">
            <span class="me-2 opacity-75">Sắp xếp theo:</span>
            <a asp-action="JobMarket" class="text-white text-decoration-underline me-3 fw-bold">Mới nhất</a>
            <a asp-action="JobMarket" asp-route-sortOrder="price_desc" class="text-white text-decoration-underline fw-bold">Ngân sách cao nhất</a>
        </div>
    </div>
</div>

<div class="container pb-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="fw-bold text-dark border-start border-4 border-primary ps-3">
            @if (Model.Any())
            {
                <span>Đang có @Model.Count() yêu cầu phù hợp</span>
            }
            else
            {

                <span>Chưa tìm thấy yêu cầu nào</span>
            }
        </h4>
    </div>

    @if (Model.Any())
    {
        <div class="row row-cols-1 row-cols-md-2 g-4">
            @foreach (var item in Model)
            {
                <div class="col">
                    <div class="card h-100 border-0 shadow-sm hover-up job-card">
                        <div class="card-body p-4">

                            <div class="d-flex justify-content-between align-items-start mb-3">
                                <div>
                                    <span class="badge bg-light text-primary border border-primary mb-2">
                                        <i class="fa-regular fa-clock me-1"></i> @item.NgayTao?.ToString("dd/MM")
                                    </span>
                                    <h5 class="card-title fw-bold text-dark mb-1">@item.TieuDe</h5>
                                </div>
                                <div class="text-end">
                                    <div class="fs-4 fw-bold text-success">@item.NganSach?.ToString("N0") đ</div>
                                    <small class="text-muted">Ngân sách</small>
                                </div>
                            </div>

                            <div class="bg-light rounded p-3 mb-3">
                                <div class="d-flex align-items-center mb-2 text-secondary">
                                    <i class="fa-solid fa-calendar-day me-3 text-center" style="width:20px"></i>
                                    <span>Ngày chụp: <strong class="text-dark">@item.NgayCanChup?.ToString("dd/MM/yyyy")</strong></span>
                                </div>
                                <div class="d-flex align-items-center text-secondary">
                                    <i class="fa-solid fa-location-dot me-3 text-center" style="width:20px"></i>
                                    <span>Địa điểm: <strong class="text-dark">@item.DiaChi</strong></span>
                                </div>
                            </div>

                            <p class="card-text text-muted small mb-4 line-clamp-2">
                                @item.MoTa
                            </p>

                            <div class="d-flex justify-content-between align-items-center pt-3 border-top border-light">
                                <div class="d-flex align-items-center">
                                    <img src="@(item.MaKhachHangNavigation?.AnhDaiDien ?? "https://ui-avatars.com/api/?name=" + item.MaKhachHangNavigation?.HoVaTen)"
                                         class="rounded-circle me-2" width="35" height="35">
                                    <div class="d-flex flex-column">
                                        <small class="text-muted" style="font-size: 0.75rem;">Đăng bởi</small>
                                        <small class="fw-bold text-dark">@item.MaKhachHangNavigation?.HoVaTen</small>
                                    </div>
                                </div>

                                <button class="btn btn-dark rounded-pill px-4 btn-sm fw-bold"
                                        data-bs-toggle="modal" data-bs-target="#applyModal-@item.MaYeuCau">
                                    <i class="fa-solid fa-hand-point-up me-2"></i> Báo giá ngay
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="applyModal-@item.MaYeuCau" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header bg-primary text-white">
                                    <h5 class="modal-title fw-bold">Ứng tuyển: @item.TieuDe</h5>
                                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                                </div>
                                <form asp-action="Apply" method="post">
                                    <div class="modal-body p-4">
                                        <input type="hidden" name="MaYeuCau" value="@item.MaYeuCau" />

                                        <div class="alert alert-light border text-center mb-3">
                                            <small class="text-muted">Ngân sách khách đề xuất:</small>
                                            <div class="fw-bold text-success fs-5">@item.NganSach?.ToString("N0") đ</div>
                                        </div>

                                        <div class="mb-3">
                                            <label class="fw-bold form-label">Mức giá bạn đề xuất (VNĐ)</label>
                                            <input type="number" name="GiaBao" class="form-control font-monospace fw-bold"
                                                   value="@(item.NganSach ?? 0)" required />
                                        </div>

                                        <div class="mb-3">
                                            <label class="fw-bold form-label">Lời nhắn cho khách</label>
                                            <textarea name="LoiNhan" class="form-control" rows="4"
                                              placeholder="Chào bạn, mình là nhiếp ảnh gia chuyên nghiệp... Mình có thể thực hiện bộ ảnh này với giá..."></textarea>
                                        </div>
                                    </div>
                                    <div class="modal-footer border-0 pt-0 px-4 pb-4">
                                        <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">Hủy</button>
                                        <button type="submit" class="btn btn-primary rounded-pill px-4 fw-bold">Gửi báo giá</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
    else
    {
        <div class="text-center py-5">
            <img src="https://cdni.iconscout.com/illustration/premium/thumb/searching-concept-illustration-download-in-svg-png-gif-file-formats--no-result-data-found-empty-state-list-user-interface-pack-design-development-illustrations-6443657.png" width="200" alt="No Data">
            <p class="text-muted mt-3">Không tìm thấy yêu cầu nào phù hợp với bộ lọc của bạn.</p>
            <a asp-action="JobMarket" class="btn btn-outline-primary rounded-pill">Xóa bộ lọc</a>
        </div>
    }
</div>

<style>
    .hover-up {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

        .hover-up:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1) !important;
            border-color: #0d6efd !important;
        }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }

    .opacity-10 {
        opacity: 0.1;
    }
</style>