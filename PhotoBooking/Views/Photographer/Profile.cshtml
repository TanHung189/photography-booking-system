@using PhotoBooking.ViewModels
@model PhotographerViewModel

@{
    ViewData["Title"] = Model.User.HoVaTen + " - Portfolio";
    // Ảnh bìa mặc định nếu chưa có
    var coverImage = Model.User.AnhBia ?? "https://images.unsplash.com/photo-1492691527719-9d1e07e534b4?auto=format&fit=crop&w=1920&q=80";
}

<div class="bg-light pb-5">

    <div class="position-relative" style="height: 350px; background-color: #333;">
        <img src="@coverImage" class="w-100 h-100 object-fit-cover opacity-75" alt="Cover Photo">
        <div class="position-absolute bottom-0 start-0 w-100 h-50 bg-gradient-to-t"></div>
    </div>

    <div class="container" style="margin-top: -100px;">
        <div class="card border-0 shadow-lg rounded-4 overflow-hidden">
            <div class="card-body p-0">
                <div class="row g-0">

                    <div class="col-lg-4 bg-white border-end position-relative p-4 text-center text-lg-start">
                        <div class="position-relative d-inline-block mb-3">
                            <img src="@(Model.User.AnhDaiDien ?? "https://ui-avatars.com/api/?name=" + Model.User.HoVaTen + "&size=200")"
                                 class="rounded-circle border border-4 border-white shadow"
                                 width="160" height="160" style="object-fit: cover;">

                            @if (Model.AvgRating > 0)
                            {
                                <span class="position-absolute bottom-0 end-0 badge rounded-pill bg-warning text-dark border border-2 border-white shadow-sm fs-6 px-2 py-1">
                                    <i class="fa-solid fa-star me-1"></i> @Model.AvgRating.ToString("0.0")
                                </span>
                            }
                        </div>

                        <h2 class="fw-bold mb-1">@Model.User.HoVaTen</h2>
                        <p class="text-muted mb-3">
                            <i class="fa-solid fa-location-dot text-danger me-1"></i>
                            @(Model.User.MaDiaDiemNavigation?.TenThanhPho ?? "Việt Nam")
                        </p>

                        @if (User.Identity.IsAuthenticated)
                        {
                            <button class="btn btn-dark w-100 rounded-pill fw-bold py-2 mb-3 shadow-sm hover-up" data-bs-toggle="modal" data-bs-target="#directBookingModal">
                                <i class="fa-regular fa-paper-plane me-2"></i> Liên hệ / Đặt lịch riêng
                            </button>
                        }
                        else
                        {
                            <a asp-controller="Account" asp-action="Login" asp-route-returnUrl="@Context.Request.Path" class="btn btn-outline-dark w-100 rounded-pill py-2 mb-3">
                                Đăng nhập để liên hệ
                            </a>
                        }

                        <div class="d-flex justify-content-center justify-content-lg-start gap-3 text-secondary fs-5">
                            <a href="#" class="text-secondary hover-primary"><i class="fa-brands fa-facebook"></i></a>
                            <a href="#" class="text-secondary hover-primary"><i class="fa-brands fa-instagram"></i></a>
                            <a href="#" class="text-secondary hover-primary"><i class="fa-brands fa-tiktok"></i></a>
                            <a href="#" class="text-secondary hover-primary"><i class="fa-solid fa-globe"></i></a>
                        </div>

                        <hr class="my-4 opacity-10">

                        <h6 class="text-uppercase text-muted small fw-bold mb-2">Giới thiệu</h6>
                        <p class="text-secondary small fst-italic">
                            @(Model.User.GioiThieu ?? "Nhiếp ảnh gia chưa cập nhật giới thiệu.")
                        </p>
                    </div>

                    <div class="col-lg-8 p-4">

                        <div class="row text-center mb-4 g-2">
                            <div class="col-4">
                                <div class="p-3 bg-light rounded-3">
                                    <h4 class="fw-bold mb-0 text-primary">@Model.PackageCount</h4>
                                    <small class="text-muted text-uppercase" style="font-size: 0.75rem;">Gói chụp</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-3 bg-light rounded-3">
                                    <h4 class="fw-bold mb-0 text-success">@Model.NamKinhNghiem</h4>
                                    <small class="text-muted text-uppercase" style="font-size: 0.75rem;">Năm kinh nghiệm</small>
                                </div>
                            </div>
                            <div class="col-4">
                                <div class="p-3 bg-light rounded-3">
                                    <h4 class="fw-bold mb-0 text-warning">@Model.ReviewCount</h4>
                                    <small class="text-muted text-uppercase" style="font-size: 0.75rem;">Đánh giá</small>
                                </div>
                            </div>
                        </div>

                        <ul class="nav nav-pills nav-fill mb-4 bg-white border rounded-pill p-1" id="profileTab" role="tablist">
                            <li class="nav-item">
                                <button class="nav-link active rounded-pill fw-bold" data-bs-toggle="tab" data-bs-target="#packages">
                                    <i class="fa-solid fa-box-open me-2"></i> Các Gói Dịch Vụ
                                </button>
                            </li>
                            <li class="nav-item">
                                <button class="nav-link rounded-pill fw-bold" data-bs-toggle="tab" data-bs-target="#albums">
                                    <i class="fa-solid fa-images me-2"></i> Album Ảnh Mẫu
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="packages">
                                @if (Model.User.GoiDichVus.Count > 0)
                                {
                                    <div class="row row-cols-1 row-cols-md-2 g-4">
                                        @foreach (var item in Model.User.GoiDichVus)
                                        {
                                            <div class="col">
                                                <div class="card h-100 border-0 shadow-sm hover-card">
                                                    <div class="position-relative">
                                                        <img src="@(item.AnhDaiDien ?? "https://source.unsplash.com/random/400x300/?photography&sig=" + item.MaGoi)"
                                                             class="card-img-top object-fit-cover" style="height: 180px;">
                                                        <span class="position-absolute top-0 end-0 m-2 badge bg-dark text-white opacity-75">
                                                            @item.MaDanhMucNavigation?.TenDanhMuc
                                                        </span>
                                                    </div>
                                                    <div class="card-body">
                                                        <h6 class="card-title fw-bold text-truncate">@item.TenGoi</h6>
                                                        <div class="d-flex justify-content-between align-items-center mt-2">
                                                            <span class="text-danger fw-bold">@item.GiaTien.ToString("N0") đ</span>
                                                            <a asp-controller="Home" asp-action="Details" asp-route-id="@item.MaGoi" class="btn btn-sm btn-outline-primary rounded-pill">
                                                                Chi tiết
                                                            </a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center py-5 text-muted">
                                        <i class="fa-solid fa-box-open fs-1 mb-3 opacity-25"></i>
                                        <p>Chưa có gói dịch vụ nào.</p>
                                    </div>
                                }
                            </div>

                            <div class="tab-pane fade" id="albums">
                                @if (Model.User.AlbumAnhs.Count > 0)
                                {
                                    <div class="row g-4">
                                        @foreach (var album in Model.User.AlbumAnhs)
                                        {
                                            <div class="col-md-6">
                                                <div class="card border-0 shadow-sm h-100 hover-card overflow-hidden">
                                                    @{
                                                        var coverImg = album.AnhChiTiets.FirstOrDefault()?.DuongDanAnh ?? "https://placehold.co/400x300?text=Empty";
                                                    }
                                                    <div class="position-relative group-hover-zoom">
                                                        <img src="@coverImg" class="card-img-top object-fit-cover transition-transform" style="height: 220px;">
                                                        <div class="position-absolute bottom-0 start-0 w-100 p-3 bg-gradient-dark text-white">
                                                            <h6 class="mb-0 fw-bold">@album.TieuDe</h6>
                                                            <small class="opacity-75">@album.AnhChiTiets.Count ảnh</small>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    </div>
                                }
                                else
                                {
                                    <div class="text-center py-5 text-muted">
                                        <i class="fa-regular fa-images fs-1 mb-3 opacity-25"></i>
                                        <p>Chưa có album nào.</p>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@if (User.Identity.IsAuthenticated)
{
    <div class="modal fade" id="directBookingModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-dark text-white">
                    <h5 class="modal-title fw-bold">Đặt lịch với @Model.User.HoVaTen</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <form asp-controller="Home" asp-action="BookDirect" method="post">
                    <div class="modal-body p-4">
                        <input type="hidden" name="MaNhiepAnhGia" value="@Model.User.MaNguoiDung" />
                        <div class="mb-3">
                            <label class="form-label fw-bold">Ngày dự kiến <span class="text-danger">*</span></label>
                            <input type="datetime-local" name="NgayChup" class="form-control" required min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Địa điểm <span class="text-danger">*</span></label>
                            <input type="text" name="DiaChiChup" class="form-control" required placeholder="Nơi bạn muốn chụp...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label fw-bold">Mô tả yêu cầu <span class="text-danger">*</span></label>
                            <textarea name="GhiChu" class="form-control" rows="4" required placeholder="Mô tả concept..."></textarea>
                        </div>
                    </div>
                    <div class="modal-footer pt-0 border-0 pb-4 px-4">
                        <button type="button" class="btn btn-light rounded-pill" data-bs-dismiss="modal">Hủy</button>
                        <button type="submit" class="btn btn-dark rounded-pill fw-bold px-4">Gửi yêu cầu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
}

<style>
    .bg-gradient-to-t {
        background: linear-gradient(to top, rgba(0,0,0,0.5), transparent);
    }

    .bg-gradient-dark {
        background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
    }

    .object-fit-cover {
        object-fit: cover;
    }

    .hover-card {
        transition: transform 0.2s, box-shadow 0.2s;
    }

        .hover-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1) !important;
        }

    .nav-pills .nav-link.active {
        background-color: #212529;
        color: white;
    }

    .nav-pills .nav-link {
        color: #555;
        transition: 0.3s;
    }

    .transition-transform {
        transition: transform 0.3s ease;
    }

    .group-hover-zoom:hover .transition-transform {
        transform: scale(1.05);
    }

    .hover-primary:hover {
        color: #0d6efd !important;
    }

    .hover-up:hover {
        transform: translateY(-2px);
    }
</style>